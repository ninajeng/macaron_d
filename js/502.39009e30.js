"use strict";(self["webpackChunkproject_macaron"]=self["webpackChunkproject_macaron"]||[]).push([[502],{2502:function(e,t,l){l.r(t),l.d(t,{default:function(){return He}});var a=l(3396),i=l(7139);const s={class:"d-flex justify-content-between pt-4 mb-3 pe-2"},o=(0,a._)("h2",{class:"m-0 fw-bolder"},"產品列表",-1),d={class:"overflow-x-auto mb-3"},r={class:"table table-hover align-middle text-nowrap"},n=(0,a._)("thead",{class:"border-dark"},[(0,a._)("tr",null,[(0,a._)("th",{width:"150"},"類別"),(0,a._)("th",null,"產品名稱"),(0,a._)("th",{width:"150",class:"text-end"},"原價"),(0,a._)("th",{width:"150",class:"text-end"},"售價"),(0,a._)("th",{width:"100",class:"text-end"},"是否啟用"),(0,a._)("th",{width:"150",class:"text-center"},"編輯/刪除")])],-1),c={class:"text-end"},u={class:"text-end"},m={class:"text-center"},p={class:"btn-group btn-group-sm",role:"group","aria-label":"Basic example"},g=["onClick"],h=["onClick"];function b(e,t,l,b,_,f){const v=(0,a.up)("LoadingVue"),w=(0,a.up)("ProductModal"),y=(0,a.up)("DeleteModal"),U=(0,a.up)("Pagination");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(v,{active:_.isLoading,style:{"z-index":"1056"}},null,8,["active"]),(0,a.Wm)(w,{ref:"productModal","temp-product":_.temp,onUpdateProduct:f.updateProduct,onCreateProduct:f.createProduct},null,8,["temp-product","onUpdateProduct","onCreateProduct"]),(0,a.Wm)(y,{ref:"deleteModal","delete-item":_.deleteProduct,item:"產品",onDelete:f.deleteId},null,8,["delete-item","onDelete"]),(0,a._)("div",s,[o,(0,a._)("button",{type:"button",class:"btn btn-secondary align-self-center me-4",onClick:t[0]||(t[0]=e=>f.editProduct())}," 新增產品 ")]),(0,a._)("div",d,[(0,a._)("table",r,[n,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(_.products,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:t.id},[(0,a._)("td",null,(0,i.zw)(t.category),1),(0,a._)("td",null,(0,i.zw)(t.title),1),(0,a._)("td",c,(0,i.zw)(e.$filters.currency(t.origin_price)),1),(0,a._)("td",u,(0,i.zw)(e.$filters.currency(t.price)),1),(0,a._)("td",{class:(0,i.C_)(["text-end text-muted",{"text-success":t.is_enabled}])},(0,i.zw)(t.is_enabled?"啟用":"未啟用"),3),(0,a._)("td",m,[(0,a._)("div",p,[(0,a._)("button",{type:"button",class:"btn btn-outline-success",onClick:e=>f.editProduct(t)}," 編輯 ",8,g),(0,a._)("button",{type:"button",class:"btn btn-outline-danger",onClick:e=>f.deleteConfirm(t)}," 刪除 ",8,h)])])])))),128))])])]),(0,a.Wm)(U,{"page-info":_.pageInfo,onSetPage:f.getData},null,8,["page-info","onSetPage"])],64)}l(560);var _=l(9242);const f={class:"modal fade",id:"productModal",tabindex:"-1",ref:"productModal"},v={class:"modal-dialog modal-xl modal-dialog-scrollable"},w={class:"modal-content"},y={class:"modal-header bg-secondary"},U={class:"modal-title fs-5 text-white"},k={class:"modal-body"},x={class:"row flex-column-reverse flex-md-row"},C={class:"col-lg-4"},M={class:"mb-3"},P=(0,a._)("p",{class:"mb-2 fw-semibold"},"產品主要圖片",-1),$={key:0},V=["src","alt"],D={class:"input-group mb-3"},I={key:1},L={class:"mb-3"},F=(0,a._)("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),W={class:"mb-3"},q=(0,a._)("label",{for:"imageFile",class:"form-label"},"上傳圖片",-1),z=(0,a._)("hr",null,null,-1),j={class:"mb-2 fw-semibold"},H={key:0},S=["src","alt"],Y={class:"input-group mb-3"},Z=["onClick"],O=["onUpdate:modelValue"],J=["onClick"],K={key:1},N={class:"mb-3"},B=["for"],E=["name","id","onUpdate:modelValue"],T={class:"mb-3"},A=["for"],G=["name","id","onChange"],Q={class:"mb-3"},R=["onClick"],X=(0,a._)("hr",null,null,-1),ee={key:0,class:"mb-3"},te={class:"col-lg-8"},le={class:"mb-3"},ae=(0,a._)("label",{for:"title",class:"form-label fw-semibold"},"標題*",-1),ie={class:"mb-3"},se={class:"row"},oe={class:"col"},de=(0,a._)("label",{for:"category",class:"form-label fw-semibold"},"分類*",-1),re={class:"col"},ne=(0,a._)("label",{for:"unit",class:"form-label fw-semibold"},"單位*",-1),ce={class:"mb-4"},ue={class:"row"},me={class:"col"},pe=(0,a._)("label",{for:"origin_price",class:"form-label fw-semibold"},"原價*",-1),ge={class:"col"},he=(0,a._)("label",{for:"price",class:"form-label fw-semibold"},"售價*",-1),be=(0,a._)("hr",null,null,-1),_e={class:"mb-3"},fe=(0,a._)("label",{for:"description",class:"form-label fw-semibold"},"產品描述",-1),ve={class:"mb-3"},we=(0,a._)("label",{for:"content",class:"form-label fw-semibold"},"說明內容",-1),ye={class:"form-check mb-3"},Ue=["checked"],ke=(0,a._)("label",{for:"is_enabled",class:"form-check-label fw-semibold"},"是否啟用",-1),xe=(0,a._)("hr",{class:"d-lg-none"},null,-1),Ce={class:"modal-footer"},Me=["onClick"];function Pe(e,t,l,s,o,d){const r=(0,a.up)("LoadingVue"),n=(0,a.up)("VField"),c=(0,a.up)("ErrorMessage"),u=(0,a.up)("VForm");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(r,{active:o.isLoading,style:{"z-index":"1056"}},null,8,["active"]),(0,a._)("div",f,[(0,a._)("div",v,[(0,a.Wm)(u,null,{default:(0,a.w5)((({errors:e})=>[(0,a._)("div",w,[(0,a._)("div",y,[(0,a._)("h1",U,(0,i.zw)(o.product.id?"編輯產品":"新增產品"),1),(0,a._)("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=(...e)=>d.hideModal&&d.hideModal(...e))})]),(0,a._)("div",k,[(0,a._)("div",x,[(0,a._)("div",C,[(0,a._)("div",M,[P,o.product.imageUrl?((0,a.wg)(),(0,a.iD)("div",$,[(0,a._)("img",{src:o.product.imageUrl,alt:o.product.title,class:"img-fluid mb-2"},null,8,V),(0,a._)("div",D,[(0,a.wy)((0,a._)("input",{type:"text",class:"form-control imagesList","onUpdate:modelValue":t[1]||(t[1]=e=>o.product.imageUrl=e)},null,512),[[_.nr,o.product.imageUrl]]),(0,a._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[2]||(t[2]=e=>o.product.imageUrl="")}," 重新上傳 ")])])):((0,a.wg)(),(0,a.iD)("div",I,[(0,a._)("div",L,[F,(0,a.wy)((0,a._)("input",{type:"text",name:"imageUrl",id:"imageUrl",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":t[3]||(t[3]=e=>o.product.imageUrl=e)},null,512),[[_.nr,o.product.imageUrl]])]),(0,a._)("div",W,[q,(0,a._)("input",{type:"file",name:"imageFile",id:"imageFile",class:"form-control",ref:"imageFile_main",onChange:t[4]||(t[4]=e=>d.uploadFile(!0))},null,544)])]))]),z,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.product.imagesUrl,((e,t)=>((0,a.wg)(),(0,a.iD)("div",{key:"url"+t},[(0,a._)("p",j,(0,i.zw)(`產品其他圖片 - ${t+1}`),1),e?((0,a.wg)(),(0,a.iD)("div",H,[(0,a._)("img",{src:e,alt:`${o.product.title}-其他圖片${t+1}`,class:"img-fluid mb-2"},null,8,S),(0,a._)("div",Y,[(0,a._)("button",{type:"button",class:"btn btn-outline-danger",onClick:e=>d.deleteImage(t)}," 刪除欄位 ",8,Z),(0,a.wy)((0,a._)("input",{type:"text",class:"form-control imagesList","onUpdate:modelValue":e=>o.product.imagesUrl[t]=e},null,8,O),[[_.nr,o.product.imagesUrl[t]]]),(0,a._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:e=>o.product.imagesUrl[t]=""}," 重新上傳 ",8,J)])])):((0,a.wg)(),(0,a.iD)("div",K,[(0,a._)("div",N,[(0,a._)("label",{for:`imageUrl_${t}`,class:"form-label"},"輸入圖片網址",8,B),(0,a.wy)((0,a._)("input",{type:"text",name:`imageUrl_${t}`,id:`imageUrl_${t}`,class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e=>o.product.imagesUrl[t]=e},null,8,E),[[_.nr,o.product.imagesUrl[t]]])]),(0,a._)("div",T,[(0,a._)("label",{for:`imageFile_${t}`,class:"form-label"},"上傳圖片",8,A),(0,a._)("input",{type:"file",name:`imageFile_${t}`,id:`imageFile_${t}`,class:"form-control",ref_for:!0,ref:"imageFile"+t,onChange:e=>d.uploadFile(!1,t)},null,40,G)]),(0,a._)("div",Q,[(0,a._)("button",{type:"button",class:"btn btn-outline-danger",onClick:e=>d.deleteImage(t)}," 刪除欄位 ",8,R)])])),X])))),128)),!o.product.imagesUrl||o.product.imagesUrl.length<5?((0,a.wg)(),(0,a.iD)("div",ee,[(0,a._)("button",{type:"button",class:"btn btn-outline-gray w-100",onClick:t[5]||(t[5]=e=>o.product.imagesUrl.push(""))}," 新增圖片欄位 ")])):(0,a.kq)("",!0)]),(0,a._)("div",te,[(0,a._)("div",le,[ae,(0,a.Wm)(n,{type:"text",name:"標題",id:"title",class:(0,i.C_)(["form-control",{"is-invalid":o.formInvalid["標題"]}]),onChange:t[6]||(t[6]=e=>delete o.formInvalid["標題"]),rules:"required",placeholder:"請輸入產品標題",modelValue:o.product.title,"onUpdate:modelValue":t[7]||(t[7]=e=>o.product.title=e),required:""},null,8,["class","modelValue"]),(0,a.Wm)(c,{name:"標題",class:"invalid-feedback"})]),(0,a._)("div",ie,[(0,a._)("div",se,[(0,a._)("div",oe,[de,(0,a.Wm)(n,{type:"text",name:"分類",id:"category",class:(0,i.C_)(["form-control",{"is-invalid":o.formInvalid["分類"]}]),onChange:t[8]||(t[8]=e=>delete o.formInvalid["分類"]),rules:"required",placeholder:"請輸入產品分類",modelValue:o.product.category,"onUpdate:modelValue":t[9]||(t[9]=e=>o.product.category=e),required:""},null,8,["class","modelValue"]),(0,a.Wm)(c,{name:"分類",class:"invalid-feedback"})]),(0,a._)("div",re,[ne,(0,a.Wm)(n,{type:"text",name:"單位",id:"unit",class:(0,i.C_)(["form-control",{"is-invalid":o.formInvalid["單位"]}]),onChange:t[10]||(t[10]=e=>delete o.formInvalid["單位"]),rules:"required",placeholder:"請輸入單位",modelValue:o.product.unit,"onUpdate:modelValue":t[11]||(t[11]=e=>o.product.unit=e),required:""},null,8,["class","modelValue"]),(0,a.Wm)(c,{name:"單位",class:"invalid-feedback"})])])]),(0,a._)("div",ce,[(0,a._)("div",ue,[(0,a._)("div",me,[pe,(0,a.Wm)(n,{type:"num",name:"原價",id:"origin_price",class:(0,i.C_)(["form-control",{"is-invalid":o.formInvalid["原價"]}]),onChange:t[12]||(t[12]=e=>delete o.formInvalid["原價"]),rules:"numeric|required",placeholder:"請輸入原價",modelValue:o.product.origin_price,"onUpdate:modelValue":t[13]||(t[13]=e=>o.product.origin_price=e),modelModifiers:{number:!0},required:""},null,8,["class","modelValue"]),(0,a.Wm)(c,{name:"原價",class:"invalid-feedback"})]),(0,a._)("div",ge,[he,(0,a.Wm)(n,{type:"num",name:"售價",id:"price",class:(0,i.C_)(["form-control",{"is-invalid":o.formInvalid["售價"]}]),onChange:t[14]||(t[14]=e=>delete o.formInvalid["售價"]),rules:"numeric|required",placeholder:"請輸入售價",modelValue:o.product.price,"onUpdate:modelValue":t[15]||(t[15]=e=>o.product.price=e),modelModifiers:{number:!0},required:""},null,8,["class","modelValue"]),(0,a.Wm)(c,{name:"售價",class:"invalid-feedback"})])])]),be,(0,a._)("div",_e,[fe,(0,a.wy)((0,a._)("textarea",{name:"description",id:"description",rows:"2",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":t[16]||(t[16]=e=>o.product.description=e)},null,512),[[_.nr,o.product.description]])]),(0,a._)("div",ve,[we,(0,a.wy)((0,a._)("textarea",{name:"content",id:"content",rows:"2",class:"form-control",placeholder:"請輸入產品說明內容","onUpdate:modelValue":t[17]||(t[17]=e=>o.product.content=e)},null,512),[[_.nr,o.product.content]])]),(0,a._)("div",ye,[(0,a.wy)((0,a._)("input",{type:"checkbox",name:"is_enabled",id:"is_enabled",class:"form-check-input active","onUpdate:modelValue":t[18]||(t[18]=e=>o.product.is_enabled=e),checked:1===o.product.is_enabled},null,8,Ue),[[_.e8,o.product.is_enabled]]),ke]),xe])])]),(0,a._)("div",Ce,[(0,a._)("button",{type:"button",class:"btn btn-outline-gray",onClick:t[19]||(t[19]=(...e)=>d.hideModal&&d.hideModal(...e))}," 取消 "),(0,a._)("button",{type:"button",class:"btn btn-secondary",onClick:t=>d.updateProduct(e)},(0,i.zw)(o.product.id?"更新":"新增"),9,Me)])])])),_:1})])],512)],64)}var $e=l(7972),Ve=l.n($e),De={data(){return{modal:{},product:{title:"",category:"",unit:"",origin_price:"",price:""},formInvalid:{},isLoading:!1}},props:["tempProduct"],emits:["updateProduct","createProduct"],inject:["emitter"],watch:{tempProduct(){this.getData()}},methods:{showModal(){this.formInvalid={},this.modal.show()},hideModal(){this.modal.hide(),this.getData()},getData(){this.product=JSON.parse(JSON.stringify(this.tempProduct)),this.product.imagesUrl||(this.product.imagesUrl=[])},updateProduct(e){if(this.formInvalid={...e},0===Object.keys(this.formInvalid).length){if(this.product.imagesUrl)for(let e=this.product.imagesUrl.length-1;e>-1;e--)""===this.product.imagesUrl[e]&&this.product.imagesUrl.splice(e,1);this.product.id?this.$emit("updateProduct",this.product):this.$emit("createProduct",this.product)}},uploadFile(e,t=0){let l;this.isLoading=!0,l=e?this.$refs.imageFile_main.files[0]:this.$refs[`imageFile${t}`][0].files[0];const a=new FormData,i="https://vue3-course-api.hexschool.io/api/nn_macaron/admin/upload";a.append("file-to-upload",l),this.axios.post(i,a).then((a=>{a.data.success?(e?this.product.imageUrl=a.data.imageUrl:(this.product.imagesUrl||(this.product.imagesUrl=[]),this.product.imagesUrl[t]=a.data.imageUrl),l=void 0):alert(a.data.message.code||a.data.message),this.isLoading=!1}))},deleteImage(e){this.product.imagesUrl.splice(e,1)}},mounted(){this.modal=new(Ve())(this.$refs.productModal,{backdrop:"static"})}},Ie=l(89);const Le=(0,Ie.Z)(De,[["render",Pe]]);var Fe=Le,We=l(5795),qe=l(2742),ze={data(){return{products:[],temp:{},deleteProduct:{},isLoading:!1,pageInfo:{}}},components:{ProductModal:Fe,DeleteModal:We.Z,Pagination:qe.Z},inject:["emitter"],methods:{getData(e=1){this.isLoading=!0,window.scrollTo({top:0});const t=`https://vue3-course-api.hexschool.io/api/nn_macaron/admin/products?page=${e}`;this.axios.get(t).then((e=>{e.data.success?(this.products=e.data.products,this.pageInfo=e.data.pagination):alert(e.data.message),this.isLoading=!1})).catch((e=>{this.isLoading=!1,alert(e)}))},editProduct(e={}){this.temp=e,this.$refs.productModal.showModal()},updateProduct(e){this.isLoading=!0;const t=`https://vue3-course-api.hexschool.io/api/nn_macaron/admin/product/${e.id}`;this.axios.put(t,{data:e}).then((t=>{t.data.success?(this.emitter.emit("sendMsg",{message:`已更新產品：${e.title}`,status:"success"}),this.$refs.productModal.hideModal(),this.getData()):this.emitter.emit("sendMsg",{message:t.data.message.join(", "),status:"error",title:"產品更新失敗"})})).catch((e=>{this.isLoading=!1,this.emitter.emit("sendMsg",{message:e,status:"error",title:"產品更新失敗"})}))},createProduct(e){this.isLoading=!0;const t="https://vue3-course-api.hexschool.io/api/nn_macaron/admin/product";this.axios.post(t,{data:e}).then((t=>{t.data.success?(this.emitter.emit("sendMsg",{message:`已新增產品：${e.title}`,status:"success"}),this.$refs.productModal.hideModal(),this.getData()):(this.isLoading=!1,this.emitter.emit("sendMsg",{message:t.data.message.join(", "),status:"error",title:"產品新增失敗"}))})).catch((e=>{this.isLoading=!1,this.emitter.emit("sendMsg",{message:e,status:"error",title:"產品新增失敗"})}))},deleteConfirm(e){this.deleteProduct=e,this.$refs.deleteModal.showModal()},deleteId(){this.isLoading=!0,this.$refs.deleteModal.hideModal();const e=`https://vue3-course-api.hexschool.io/api/nn_macaron/admin/product/${this.deleteProduct.id}`;this.axios.delete(e).then((e=>{e.data.success?this.emitter.emit("sendMsg",{message:`已刪除產品：${this.deleteProduct.title}`,status:"success"}):this.emitter.emit("sendMsg",{message:`${e.data.message}`,status:"error",title:"產品刪除失敗"}),this.getData(this.pageInfo.current_page)})).catch((e=>{this.isLoading=!1,this.emitter.emit("sendMsg",{message:`${e}`,status:"error",title:"產品刪除失敗"})}))}},created(){this.getData()}};const je=(0,Ie.Z)(ze,[["render",b]]);var He=je}}]);
//# sourceMappingURL=502.39009e30.js.map