"use strict";(self["webpackChunkproject_macaron"]=self["webpackChunkproject_macaron"]||[]).push([[799],{7799:function(e,t,o){o.r(t),o.d(t,{default:function(){return ae}});var a=o(3396),s=o(7139);const i={class:"d-flex justify-content-between pt-4 mb-3 pe-1"},n=(0,a._)("h2",{class:"m-0 fw-bolder"},"優惠券列表",-1),l={class:"overflow-x-auto mb-3"},d={class:"table table-hover align-middle text-nowrap"},u=(0,a._)("thead",{class:"border-dark"},[(0,a._)("tr",null,[(0,a._)("th",null,"優惠券代碼"),(0,a._)("th",null,"優惠券名稱"),(0,a._)("th",{class:"text-center"},"折扣內容"),(0,a._)("th",null,"優惠截止時間"),(0,a._)("th",null,"優惠券狀態"),(0,a._)("th",{width:"150",class:"text-center"},"編輯/刪除")])],-1),c={class:"text-center"},r={key:0,class:"bi bi-check fw-bolder"},m={key:1,class:"bi bi-x"},p={key:2,class:"text-danger"},h={key:3},g={key:4,class:"text-danger"},f={key:5},b={class:"text-center"},_={class:"btn-group btn-group-sm",role:"group","aria-label":"Basic example"},v=["onClick"],C=["onClick"];function k(e,t,o,k,x,M){const D=(0,a.up)("LoadingVue"),w=(0,a.up)("CouponModal"),T=(0,a.up)("DeleteModal"),y=(0,a.up)("Pagination");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(D,{active:x.isLoading,style:{"z-index":"1056"}},null,8,["active"]),(0,a.Wm)(w,{"temp-coupon":x.tempCoupon,onUpdateCoupon:M.updateCoupon,onCreateCoupon:M.createCoupon,ref:"couponModal"},null,8,["temp-coupon","onUpdateCoupon","onCreateCoupon"]),(0,a.Wm)(T,{ref:"deleteModal","delete-item":x.deleteCoupon,item:"優惠券",onDelete:M.deleteId},null,8,["delete-item","onDelete"]),(0,a._)("div",i,[n,(0,a._)("button",{type:"button",class:"btn btn-secondary align-self-center me-3",onClick:t[0]||(t[0]=e=>M.editCoupon())}," 新增優惠券 ")]),(0,a._)("div",l,[(0,a._)("table",d,[u,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(x.couponList,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:t.id},[(0,a._)("td",null,(0,s.zw)(t.code),1),(0,a._)("td",null,(0,s.zw)(t.title),1),(0,a._)("td",c,(0,s.zw)(t.percent/10+"折"),1),(0,a._)("td",null,(0,s.zw)(e.$filters.unixToDatetime(t.due_date)),1),(0,a._)("td",{class:(0,s.C_)(M.checkStatus(t)?"text-success":"text-gray")},[M.checkStatus(t)?((0,a.wg)(),(0,a.iD)("i",r)):((0,a.wg)(),(0,a.iD)("i",m)),t.due_date<Date.now().toString().substring(0,10)?((0,a.wg)(),(0,a.iD)("span",p,"已過期")):((0,a.wg)(),(0,a.iD)("span",h,"尚未過期")),(0,a.Uk)(", "),t.is_enabled?((0,a.wg)(),(0,a.iD)("span",f,"啟用")):((0,a.wg)(),(0,a.iD)("span",g,"未啟用"))],2),(0,a._)("td",b,[(0,a._)("div",_,[(0,a._)("button",{type:"button",class:"btn btn-outline-success",onClick:e=>M.editCoupon(t)}," 編輯 ",8,v),(0,a._)("button",{type:"button",class:"btn btn-outline-danger",onClick:e=>M.deleteConfirm(t)}," 刪除 ",8,C)])])])))),128))])])]),(0,a.Wm)(y,{"page-info":x.pageInfo,onSetPage:M.getCoupon},null,8,["page-info","onSetPage"])],64)}var x=o(9242);const M={class:"modal fade",tabindex:"-1",ref:"couponModal"},D={class:"modal-dialog modal-lg modal-dialog-scrollable"},w={class:"modal-content"},T={class:"modal-header bg-secondary"},y=(0,a._)("h1",{class:"modal-title fs-5 text-white"},"優惠券資料",-1),V={class:"modal-body p-4 text-secondary"},L={class:"mb-3"},$=(0,a._)("label",{for:"code",class:"form-label"},"優惠券代碼*",-1),I={class:"mb-3"},S=(0,a._)("label",{for:"title",class:"form-label"},"優惠券名稱*",-1),W={class:"mb-3"},U=(0,a._)("label",{for:"percent",class:"form-label"},[(0,a.Uk)("折扣內容* "),(0,a._)("span",{class:"text-muted"},"(限制：1~99)")],-1),H={class:"ms-1"},j={class:"d-lg-flex"},z={class:"me-5"},q=(0,a._)("label",{for:"dueDate",class:"form-label"},"優惠截止日期*",-1),P={class:"mt-3 mt-lg-0"},Z=(0,a._)("label",{for:"dueTimeHour",class:"form-label"},"優惠截止時間*",-1),O={class:"form-check my-3"},Y=["checked"],F=(0,a._)("label",{for:"is_enabled",class:"form-check-label"},"是否啟用",-1),J={class:"modal-footer"},N=["onClick"];function B(e,t,o,i,n,l){const d=(0,a.up)("LoadingVue"),u=(0,a.up)("VField"),c=(0,a.up)("ErrorMessage"),r=(0,a.up)("VForm");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(d,{active:n.isLoading,style:{"z-index":"1056"}},null,8,["active"]),(0,a._)("div",M,[(0,a._)("div",D,[(0,a.Wm)(r,null,{default:(0,a.w5)((({errors:e})=>[(0,a._)("div",w,[(0,a._)("div",T,[y,(0,a._)("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=(...e)=>l.hideModal&&l.hideModal(...e))})]),(0,a._)("div",V,[(0,a._)("div",L,[$,(0,a.Wm)(u,{type:"text",name:"優惠券代碼",id:"code",class:(0,s.C_)(["form-control",{"is-invalid":n.formInvalid["優惠券代碼"]}]),onChange:t[1]||(t[1]=e=>delete n.formInvalid["優惠券代碼"]),rules:"required",modelValue:n.coupon.code,"onUpdate:modelValue":t[2]||(t[2]=e=>n.coupon.code=e),placeholder:"請輸入優惠券代碼"},null,8,["class","modelValue"]),(0,a.Wm)(c,{name:"優惠券代碼",class:"invalid-feedback"})]),(0,a._)("div",I,[S,(0,a.Wm)(u,{type:"text",name:"優惠券名稱",id:"title",class:(0,s.C_)(["form-control",{"is-invalid":n.formInvalid["優惠券名稱"]}]),onChange:t[3]||(t[3]=e=>delete n.formInvalid["優惠券名稱"]),rules:"required",modelValue:n.coupon.title,"onUpdate:modelValue":t[4]||(t[4]=e=>n.coupon.title=e),placeholder:"請輸入優惠券名稱"},null,8,["class","modelValue"]),(0,a.Wm)(c,{name:"優惠券名稱",class:"invalid-feedback"})]),(0,a._)("div",W,[U,(0,a._)("div",null,[(0,a.Wm)(u,{type:"number",name:"優惠券折扣數",class:(0,s.C_)(["form-control d-inline-block me-1",{"is-invalid":n.formInvalid["優惠券折扣數"]}]),onChange:t[5]||(t[5]=e=>delete n.formInvalid["優惠券折扣數"]),rules:"required",style:{width:"250px"},id:"percent",modelValue:n.coupon.percent,"onUpdate:modelValue":t[6]||(t[6]=e=>n.coupon.percent=e),min:"1",max:"99",placeholder:"請輸入折扣數（如：90）"},null,8,["class","modelValue"]),(0,a.Uk)(" ="),(0,a._)("span",H,(0,s.zw)(n.coupon.percent?n.coupon.percent/10:"？")+"折",1),(0,a.Wm)(c,{name:"優惠券折扣數",class:"invalid-feedback"})])]),(0,a._)("div",j,[(0,a._)("div",z,[q,(0,a.Wm)(u,{type:"date",name:"截止日期",class:(0,s.C_)(["form-control",{"is-invalid":n.formInvalid["截止日期"]}]),onChange:t[7]||(t[7]=e=>delete n.formInvalid["截止日期"]),rules:"required",style:{width:"250px"},id:"dueDate",ref:"dueDateDefault",modelValue:n.dueDateLocal,"onUpdate:modelValue":t[8]||(t[8]=e=>n.dueDateLocal=e),onInput:t[9]||(t[9]=e=>n.dueDateLocal=e.target.value),min:"2123-1-01",max:"2123-12-31"},null,8,["class","modelValue"]),(0,a.Wm)(c,{name:"截止日期",class:"invalid-feedback"})]),(0,a._)("div",P,[Z,(0,a._)("div",null,[(0,a.Wm)(u,{type:"number",name:"截止時間(hour)",class:(0,s.C_)(["form-control d-inline-block w-auto",{"is-invalid":n.formInvalid["截止時間(hour)"]}]),onChange:t[10]||(t[10]=e=>delete n.formInvalid["截止時間(hour)"]),rules:"required",id:"dueTimeHour",modelValue:n.dueTimeHour,"onUpdate:modelValue":t[11]||(t[11]=e=>n.dueTimeHour=e),placeholder:"時",min:"0",max:"23"},null,8,["class","modelValue"]),(0,a.Uk)("： "),(0,a.Wm)(u,{type:"number",name:"截止時間(minute)",class:(0,s.C_)(["form-control d-inline-block w-auto",{"is-invalid":n.formInvalid["截止時間(minute)"]}]),onChange:t[12]||(t[12]=e=>delete n.formInvalid["截止時間(minute)"]),rules:"required",modelValue:n.dueTimeMinute,"onUpdate:modelValue":t[13]||(t[13]=e=>n.dueTimeMinute=e),placeholder:"分",min:"0",max:"59"},null,8,["class","modelValue"]),(0,a.Uk)("： "),(0,a.Wm)(u,{type:"number",name:"截止時間(sec)",class:(0,s.C_)(["form-control d-inline-block w-auto",{"is-invalid":n.formInvalid["截止時間(sec)"]}]),onChange:t[14]||(t[14]=e=>delete n.formInvalid["截止時間(sec)"]),rules:"required",modelValue:n.dueTimeSec,"onUpdate:modelValue":t[15]||(t[15]=e=>n.dueTimeSec=e),placeholder:"秒",min:"0",max:"59"},null,8,["class","modelValue"]),(0,a.Wm)(c,{name:"截止時間(hour)",class:"invalid-feedback"}),(0,a.Wm)(c,{name:"截止時間(minute)",class:"invalid-feedback"}),(0,a.Wm)(c,{name:"截止時間(sec)",class:"invalid-feedback"})])])]),(0,a._)("div",O,[(0,a.wy)((0,a._)("input",{type:"checkbox",name:"is_enabled",id:"is_enabled",class:"form-check-input active","onUpdate:modelValue":t[16]||(t[16]=e=>n.coupon.is_enabled=e),checked:1===n.coupon.is_enabled},null,8,Y),[[x.e8,n.coupon.is_enabled]]),F])]),(0,a._)("div",J,[(0,a._)("button",{type:"button",class:"btn btn-outline-gray",onClick:t[17]||(t[17]=(...e)=>l.hideModal&&l.hideModal(...e))}," 取消 "),(0,a._)("button",{type:"button",class:"btn btn-secondary",onClick:t=>l.updateCoupon(e)},(0,s.zw)(n.coupon.id?"更新":"新增"),9,N)])])])),_:1})])],512)],64)}var E=o(7972),K=o.n(E),A={data(){return{modal:{},coupon:{code:"",title:"",percent:90,is_enabled:!0},dueDateDefault:"",dueDateLocal:"",dueTimeHour:"23",dueTimeMinute:"59",dueTimeSec:"59",formInvalid:{},isLoading:!1}},props:["tempCoupon"],emits:["updateCoupon","createCoupon"],inject:["emitter"],watch:{tempCoupon(){this.getData()},dueDate_unix(){10===this.dueDate_unix.toString().length&&(this.coupon.due_date=this.dueDate_unix)},dueTimeHour(){this.dueTimeHour=this.checkValue(this.dueTimeHour,23,0)},dueTimeMinute(){this.dueTimeMinute=this.checkValue(this.dueTimeMinute,59,0)},dueTimeSec(){this.dueTimeSec=this.checkValue(this.dueTimeSec,59,0)},coupon:{handler(){""!==this.coupon.percent&&(this.coupon.percent=this.checkValue(this.coupon.percent,99,1))},deep:!0}},computed:{dueDate_unix(){if(this.dueDateLocal&&""!==this.dueTimeHour&&""!==!this.dueTimeMinute&&""!==!this.dueTimeSec){const e=`${this.dueDateLocal} ${this.dueTimeHour}:${this.dueTimeMinute}:${this.dueTimeSec}`;return this.$filters.datetimeToUnix(e)}return"請輸入截止日期與時間！"}},methods:{showModal(){this.formInvalid={},this.modal.show()},hideModal(){this.modal.hide(),this.getData()},getData(){if(this.coupon=JSON.parse(JSON.stringify(this.tempCoupon)),this.coupon.due_date){this.dueDateLocal=this.$filters.unixToDate(this.coupon.due_date);const e=this.$filters.unixToTime(this.coupon.due_date).split(":");this.dueTimeHour=e[0],this.dueTimeMinute=e[1],this.dueTimeSec=e[2]}else this.dueDateLocal=this.dueDateDefault,this.dueTimeHour=24,this.dueTimeMinute=59,this.dueTimeSec=59,this.coupon.is_enabled=!0},updateCoupon(e={}){this.formInvalid={...e},0===Object.keys(this.formInvalid).length&&(this.coupon.is_enabled=this.coupon.is_enabled?1:0,this.coupon.id?this.$emit("updateCoupon",this.coupon):this.$emit("createCoupon",this.coupon))},checkValue(e,t,o){return e<o?o:e>t?t:e}},mounted(){this.modal=new(K())(this.$refs.couponModal,{backdrop:"static"}),this.dueDateDefault=this.$filters.unixToDate(new Date/1e3)}},G=o(89);const Q=(0,G.Z)(A,[["render",B]]);var R=Q,X=o(5795),ee=o(2742),te={data(){return{couponList:[],tempCoupon:{},couponStatus:{},deleteCoupon:{},isLoading:!1,pageInfo:{}}},inject:["emitter"],components:{CouponModal:R,DeleteModal:X.Z,Pagination:ee.Z},methods:{getCoupon(e=1){this.isLoading=!0,window.scrollTo({top:0});const t="https://vue3-course-api.hexschool.io/api/nn_macaron/admin/coupons?page=1";this.axios.get(t).then((e=>{e.data.success?(this.couponList=e.data.coupons,this.pageInfo=e.data.pagination):this.emitter.emit("sendMsg",{message:`優惠券讀取失敗：${e.data.message}`,status:"error"}),this.isLoading=!1})).catch((e=>{this.isLoading=!1,this.emitter.emit("sendMsg",{message:`優惠券讀取失敗：${e}`,status:"error"})}))},editCoupon(e={}){this.tempCoupon=e,this.$refs.couponModal.showModal()},updateCoupon(e){this.isLoading=!0;const t=`https://vue3-course-api.hexschool.io/api/nn_macaron/admin/coupon/${e.id}`;this.axios.put(t,{data:e}).then((t=>{t.data.success?(this.emitter.emit("sendMsg",{message:`優惠券已更新：${e.title}`,status:"success"}),this.$refs.couponModal.hideModal(),this.getCoupon()):(this.isLoading=!1,this.emitter.emit("sendMsg",{message:t.data.message.join(", "),status:"error",title:"優惠券更新失敗"}))})).catch((e=>{this.isLoading=!1,this.emitter.emit("sendMsg",{message:e,status:"error",title:"優惠券更新失敗"})}))},createCoupon(e){const t="https://vue3-course-api.hexschool.io/api/nn_macaron/admin/coupon";this.isLoading=!0,this.axios.post(t,{data:e}).then((t=>{t.data.success?(this.emitter.emit("sendMsg",{message:`已新增優惠券：${e.title}`,status:"success"}),this.$refs.couponModal.hideModal(),this.getCoupon()):(this.isLoading=!1,this.emitter.emit("sendMsg",{message:t.data.message.join(", "),status:"error",title:"優惠券新增失敗"}))})).catch((e=>{this.isLoading=!1,this.emitter.emit("sendMsg",{message:e,status:"error",title:"優惠券新增失敗"})}))},deleteConfirm(e){this.deleteCoupon=e,this.$refs.deleteModal.showModal()},deleteId(){this.isLoading=!0,this.$refs.deleteModal.hideModal();const e=`https://vue3-course-api.hexschool.io/api/nn_macaron/admin/coupon/${this.deleteCoupon.id}`;this.axios.delete(e).then((e=>{e.data.success?this.emitter.emit("sendMsg",{message:`已刪除優惠券：${this.deleteCoupon.title}`,status:"success"}):this.emitter.emit("sendMsg",{message:`${e.data.message}`,status:"error",title:"優惠券刪除失敗"}),this.getCoupon(this.pageInfo.current_page)})).catch((e=>{this.isLoading=!1,this.emitter.emit("sendMsg",{message:`${e}`,status:"error",title:"優惠券刪除失敗"})}))},checkStatus(e){return e.due_date>Date.now().toString().substring(0,10)&&e.is_enabled}},created(){this.getCoupon()}};const oe=(0,G.Z)(te,[["render",k]]);var ae=oe}}]);
//# sourceMappingURL=799.b0355537.js.map